# FinLoom 快速启动指南

## 🚀 立即开始使用

### 第一步：启动服务器

```bash
# 进入项目目录
cd C:\Users\Sycamore\Desktop\FinLoom-server

# 启动服务器（会自动配置虚拟环境和安装依赖）
python main.py
```

**预期输出**:
```
🔧 设置虚拟环境...
✅ 虚拟环境已存在
📦 安装项目依赖...
✅ 依赖安装成功
🚀 启动FinLoom Web应用...
✅ 端口 8000 可用
⚙️ 初始化系统...
✅ 系统初始化完成
🌐 启动Web服务器...
📍 访问地址: http://localhost:8000
```

### 第二步：配置FIN-R1模型 ⚠️ 重要

**为什么需要这一步？**
- 智能对话和策略制定功能需要FIN-R1模型
- 如果不配置，这些功能将无法使用

**操作步骤**:

1. **打开模型管理页面**:
   ```
   http://localhost:8000/web/pages/model-manager.html
   ```

2. **查看系统配置**:
   - 检查CPU、内存、磁盘是否满足要求
   - 查看可用磁盘空间

3. **选择配置方式**:

   **方式A: 搜索本地模型（如果已下载）**
   ```
   1. 点击"搜索本地模型"按钮
   2. 等待搜索完成
   3. 如果找到模型，点击"使用此模型"
   4. 完成！
   ```

   **方式B: 下载新模型（推荐）**
   ```
   1. 点击"下载新模型"按钮
   2. 选择安装磁盘（建议选择空间充足的盘）
   3. 确认安装路径（例如：D:\AI_Models\Fin-R1）
   4. 选择模型来源：ModelScope（国内快）
   5. 点击"开始下载"
   6. 等待下载完成（约10-30分钟）
   7. 完成！
   ```

   **方式C: 手动配置路径**
   ```
   1. 如果已经下载了模型到其他位置
   2. 点击"手动配置模型路径"
   3. 输入模型的完整路径
   4. 点击"确认配置"
   5. 完成！
   ```

### 第三步：测试功能

#### 测试智能对话

1. 访问：`http://localhost:8000/web/pages/chat-mode.html`
2. 如果看到橙色警告横幅 → 返回第二步配置模型
3. 如果没有警告 → 输入问题进行测试：
   ```
   "请帮我分析一下平安银行这只股票"
   "如何构建一个稳健的投资组合？"
   "当前市场适合投资吗？"
   ```
4. 等待FIN-R1分析（10-30秒）
5. 查看智能回复

#### 测试策略制定

1. 访问：`http://localhost:8000/web/pages/strategy-mode.html`
2. 填写投资需求表单：
   - 收益目标：15%
   - 风险偏好：稳健型
   - 初始资金：100万
   - 其他参数...
3. 点击"下一步：生成策略"
4. 等待策略生成（15-45秒）
5. 查看生成的策略、推荐股票和Python代码

#### 测试数据管理

1. 访问：`http://localhost:8000/web/pages/data-manager.html`
2. 查看数据概览
3. 确认日期是当前日期
4. 点击刷新按钮测试

## 📊 功能验证清单

使用以下清单确保所有功能正常：

### 基础功能
- [ ] 服务器成功启动
- [ ] 可以访问主页
- [ ] 侧边栏在所有页面显示
- [ ] 页面间导航正常

### FIN-R1模型
- [ ] 模型管理页面可以访问
- [ ] 系统配置检测正常
- [ ] 可用磁盘列表正常显示
- [ ] 模型状态显示正确
- [ ] 模型配置成功（三种方式任选一种）

### 智能对话
- [ ] 页面正常加载
- [ ] 没有橙色警告横幅（或已配置模型）
- [ ] 可以发送消息
- [ ] 收到FIN-R1的回复
- [ ] 回复包含投资建议
- [ ] 侧边栏正常显示

### 策略制定
- [ ] 页面正常加载
- [ ] 没有橙色警告横幅
- [ ] 可以填写表单
- [ ] 进度条正常显示
- [ ] 策略生成成功
- [ ] 显示推荐股票
- [ ] 显示策略代码
- [ ] 侧边栏正常显示

### 数据管理
- [ ] 页面正常加载
- [ ] 数据概览正确显示
- [ ] 日期是当前日期
- [ ] 股票列表显示
- [ ] 刷新功能正常
- [ ] 侧边栏正常显示

## ⚡ 性能优化

如果遇到性能问题，按以下顺序尝试：

### 1. 立即生效的优化

**已自动应用**:
- ✅ GZIP压缩（减少传输数据量）
- ✅ 异步API调用（不阻塞页面）
- ✅ 错误降级策略（FIN-R1不可用时使用规则引擎）

### 2. 可选的优化

**减少FIN-R1推理时间**:

编辑文件：`module_10_ai_interaction/config/fin_r1_config.yaml`

```yaml
model:
  max_length: 1024      # 从2048减少到1024
  temperature: 0.5      # 从0.7减少到0.5，更快
  do_sample: false      # 使用贪心解码，不采样
```

**如果有GPU**:

```yaml
model:
  device: "cuda"        # 从cpu改为cuda
  torch_dtype: "float16"  # 使用半精度
```

### 3. 清除缓存

**浏览器缓存**:
- Chrome/Edge: `Ctrl + Shift + Delete`
- 选择"缓存的图像和文件"
- 点击"清除数据"

## 🐛 常见问题

### Q: 服务器启动失败？

**检查**:
1. 是否已安装Python 3.8+：`python --version`
2. 是否在正确的目录
3. 查看错误日志

**解决**:
```bash
# 重新安装依赖
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 重新启动
python main.py
```

### Q: FIN-R1模型下载失败？

**检查**:
1. 网络连接是否正常
2. 是否安装了Git LFS：`git lfs version`
3. 磁盘空间是否充足（至少10GB）

**解决**:
```bash
# 安装Git LFS
git lfs install

# 手动下载（推荐）
git clone https://www.modelscope.cn/AI-ModelScope/Fin-R1.git D:\AI_Models\Fin-R1

# 然后在模型管理页面"手动配置模型路径"
```

### Q: 对话功能没有反应？

**检查**:
1. 是否看到橙色警告横幅？
   - 是 → 需要先配置FIN-R1模型
2. 浏览器控制台是否有错误？
   - F12 → Console
3. 服务器日志是否有错误？
   - 查看 `logs/fin_r1_integration.log`

**解决**:
1. 确保FIN-R1模型已配置
2. 重启服务器
3. 清除浏览器缓存
4. 检查防火墙设置

### Q: 页面加载很慢？

**检查**:
1. 网络连接速度
2. 服务器CPU和内存使用率
3. FIN-R1配置是否优化

**解决**:
1. 应用FIN-R1配置优化（见上文）
2. 清除浏览器缓存
3. 关闭其他占用资源的程序
4. 考虑使用GPU加速

### Q: 数据停留在2024年？

**已修复** ✅
- 数据现在使用当前日期
- 从后端API获取实时数据
- 自动显示更新时间

如仍有问题：
1. 刷新页面
2. 检查API响应：`curl http://localhost:8000/api/v1/data/overview`
3. 查看服务器日志

## 📝 技术支持

### 查看日志

```bash
# 查看FIN-R1日志
tail -f logs/fin_r1_integration.log

# 查看所有日志
ls -la logs/

# 搜索错误
grep -i error logs/*.log
```

### API测试

```bash
# 测试健康检查
curl http://localhost:8000/health

# 测试模型状态
curl http://localhost:8000/api/v1/model/status

# 测试对话API
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "你好"}'
```

### 性能分析

1. **浏览器开发者工具**:
   - F12 → Network：查看请求时间
   - F12 → Console：查看JavaScript错误
   - F12 → Performance：分析性能瓶颈

2. **服务器监控**:
   - 查看CPU使用率：任务管理器
   - 查看内存使用：任务管理器
   - 查看日志：logs目录

## 📚 相关文档

- `TESTING_GUIDE.md` - 完整测试指南
- `修复总结.md` - 功能修复详情
- `性能优化建议.md` - 深入的性能优化方案
- `INTEGRATION_REPORT.md` - FIN-R1集成说明

## 🎯 总结

**必须完成的步骤**:
1. ✅ 启动服务器
2. ⚠️ 配置FIN-R1模型（重要！）
3. ✅ 测试功能

**可选的优化**:
- 调整FIN-R1配置
- 启用GPU加速
- 清除浏览器缓存

**验证成功的标志**:
- 智能对话能收到回复
- 策略制定能生成策略
- 数据管理显示当前日期
- 所有页面侧边栏正常显示

---

**开始使用**: `python main.py` → 访问 `http://localhost:8000/web/pages/model-manager.html` 配置模型！







