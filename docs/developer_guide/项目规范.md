# 项目规范

## 项目概述

`FinLoom` 是一个FIN-R1 赋能的自适应量化投资引擎，金织FinLoom “金融（Fin）+ 编织（Loom）”，寓意系统像织布机一样，将数据、因子、模型、用户需求等元素编织成个性化的投资组合，科技感与艺术感兼具。

系统以 **FIN-R1 模型** 作为自然语言理解入口，支持用户通过文本输入表达投资需求（如“找高成长性中小盘股”），系统自动解析并生成对应的量化策略。

整体流程为：
```
用户输入 → NLP 解析 → 策略生成 → 数据处理 → 回测/实盘 → 风控校验 → 交易执行
```

### 核心功能模块

模块1负责数据的"感知"功能，从多个渠道实时获取市场数据。模块2承担"认知"功能，通过神经网络自动发现有效的投资因子。模块3实现"学习"功能，集成多种机器学习模型进行市场预测。模块4提供"保护"功能，实施智能风险管理。模块5执行"监控"功能，实时跟踪系统状态。模块6负责"进化"功能，持续优化系统参数。模块7执行"行动"功能，实施具体的交易操作。模块8提供"验证"功能，通过回测确保策略有效性。

```
FinLoom-server/
├── __init__.py
├── main.py
├── requirements .txt
├── setup.py
├── module_00_environment/
|   ├── __init__ .py
|   ├── config_loader .py
|   ├── dependency_installer.py
|   ├── env_checker.py
|   ├── health_monitor.py
|   ├── system_validator .py
├── config/
|   ├── model_config.yaml
|   ├── system_config.yaml
|   ├── trading_config.yaml
├── module_01_data_pipeline/
|   ├── data_processing/
|   ├── storage_management/
|   ├── data_acquisition/
|   ├── stream_processing/
├── module_05_risk_management/
|   ├── __init__.py
|   ├── stop-loss_strategies/
|   ├── position_sizing/
|   ├── stress_testing/
|   ├── portfolio_optimization/
├── module_02_feature_engineering/
|   ├── feature_extraction/
|   ├── temporal_features/
|   ├── graph_features/
|   ├── factor_discovery/
├── tests/
├── docs/
|   ├── developer_guide/
├── module_11_visualization/
|   ├── __init__.py
|   ├── chart_generator.py
|   ├── dashboard_manager.py
|   ├── export_manager.py
|   ├── interactive_visualizer.py
|   ├── report_builder.py
|   ├── template_engine.py
|   ├── config/
├── module_09_backtesting/
|   ├── __init__.py
|   ├── backtest_engine.py
|   ├── market_impact_model.py
|   ├── performance_analyzer.py
|   ├── report_generator.py
|   ├── risk_attribution.py
|   ├── transaction_simulator.py
|   ├── validation_tools.py
|   ├── walk_forward_analyzer.py
├── common/
|   ├── constants.py
|   ├── data_structures.py
|   ├── exceptions.py
|   ├── logging_system.py
├── module_06_monitoring_alerting/
|   ├── __init__.py
|   ├── notification_service/
|   ├── reporting_engine/
|   ├── alert_system/
|   ├── real_time_monitoring/
├── module_08_execution/
|   ├── __init__.py
|   ├── broker_connector.py
|   ├── execution_algorithms.py
|   ├── execution_monitor.py
|   ├── market_impact_model.py
|   ├── order_manager.py
|   ├── order_router.py
|   ├── signal_filter.py
|   ├── signal_generator.py
|   ├── transaction_logger.py
|   ├── broker_adapters/
├── module_04_market_analysis/
|   ├── __init__.py
|   ├── anomaly_detection/
|   ├── regime_detection/
|   ├── correlation_analysis/
|   ├── sentiment_analysis/
├── module_07_optimization/
|   ├── __init__.py
|   ├── base_optimizer.py
|   ├── optimization_manager.py
|   ├── strategy-optimization/
|   ├── multi_objective_opt/
|   ├── resource_optimization/
|   ├── hyperparameter_tuning/
├── module_10_ai_interaction/
|   ├── __init__.py
|   ├── conversation_history.py
|   ├── dialogue_manager.py
|   ├── fin_r1_integration.py
|   ├── intent_classifier.py
|   ├── nip-processor.py
|   ├── parameter_mapper.py
|   ├── recommendation_engine.py
|   ├── requirement_parser.py
|   ├── response_generator.py
|   ├── config/
├── module_03_ai_models/
|   ├── __init__.py
|   ├── ensemble_methods/
|   ├── reinforcement_learning/
|   ├── deep_learning/
|   ├── online_learning/
```

例如：用户提出新的投资需求时，模块9 首先进行需求解析和风险评估，然后生成相应的参数调整指令，传递给相关模块。例如，当用户表达保守投资倾向时，模块9 会指示模块2 调整因子权重，倾向于低波动和价值因子；指示模块4 降低风险容忍度，加强风险控制；指示模块7 调整交易频率，减少不必要的交易成本。

## 技术栈


| 组件 | 版本 | 用途 |
|------|------|------|
| Python | 3.9+ | 主语言 |
| PyTorch | 2.0+ | 仅用于 FIN-R1 模型推理（非训练） |
| SQLite  |      | 数据库                           |
|         |      |                                  |
|         |      |                                  |


### 开发建议

- **数据优先**  
   所有模型依赖数据质量，建议先建立清晰的数据管道（CSV → DuckDB → 策略输入）

- **避免过度工程化**  
   - 不必一开始就上 Kafka
   - 不必强求 Transformer 架构
   - FIN-R1 只需加载模型做推理即可

- **模块解耦**  
   每个模块独立运行，通过文件或 API 通信，方便调试与替换。

## 模块间通信协议

系统采用事件驱动架构和消息队列进行模块间通信。

### 统一消息格式

```python
# 模块间消息格式
InterModuleMessage = {
    'message_id': str,
    'timestamp': datetime,
    'source_module': str,
    'target_module': str,
    'message_type': str,  # 'DATA', 'COMMAND', 'QUERY', 'RESPONSE'
    'priority': int,      # 1-10, 10最高
    'payload': dict,
    'require_ack': bool,
    'timeout_ms': int
}
```

## API接口规范

所有模块对外提供 RESTful API 接口。

### API 接口示例

```python
# FastAPI路由定义
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel

router = APIRouter()

class TradingSignal(BaseModel):
    symbol: str
    action: str  # 'BUY', 'SELL', 'HOLD'
    quantity: int
    confidence: float

@router.post("/api/v1/signals/generate")
async def generate_trading_signals(
    market_data: dict,
    strategy_params: dict
) -> list[TradingSignal]:
    """生成交易信号API"""
    pass

@router.get("/api/v1/portfolio/status")
async def get_portfolio_status() -> dict:
    """获取组合状态API"""
    pass
```
